<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Jenkins | SkyView</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Jenkins" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Overview" />
<meta property="og:description" content="Overview" />
<link rel="canonical" href="http://localhost:4000/docs/especificacao/jenkins/" />
<meta property="og:url" content="http://localhost:4000/docs/especificacao/jenkins/" />
<meta property="og:site_name" content="SkyView" />
<script type="application/ld+json">
{"@type":"Article","url":"http://localhost:4000/docs/especificacao/jenkins/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/images/favicon.png"}},"headline":"Jenkins","description":"Overview","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="SkyView" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/images/favicon.png">

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/" style="display:table;">
					<span style="display:table-cell;vertical-align:middle;" class="back-arrow icon"><svg fill="#000000" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><rect id="backgroundrect" width="100%" height="100%" x="0" y="0" fill="none" stroke="none"/>
  
  
<g class="currentLayer" style=""><title>Layer 1</title><path d="M0 0h24v24H0z" fill="none" id="svg_1"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" id="svg_2" class="selected" fill="#ffffff" fill-opacity="1"/></g></svg></span>
					<img style="display:table-cell;" src="/images/favicon.png" width="40" height="40" alt="SkyView logo">
				</a>
				SkyView
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href=""><b>Documentação</b></a>
					</li>
				</ul>

				
				
				
				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/docs/an%C3%A1lise/cenarios/">Análise</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/an%C3%A1lise/cenarios/">Cenários</a></li>
								
							</ul>
						</li>
					
				</ul>
				
				
				
				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/docs/desenvolvimento/arquitetura/">Desenvolvimento</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/arquitetura/">Arquitetura</a></li>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/consumers/">Consumers</a></li>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/producers/">Producers</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/docs/especificacao/jenkins/">Especificação</a>
							<ul>
								
									<li class="nav-item current"><a href="/docs/especificacao/jenkins/">Jenkins</a></li>
								
									<li class="nav-item "><a href="/docs/especificacao/deployment/">Deployment</a></li>
								
									<li class="nav-item "><a href="/docs/especificacao/monitoring/">Monitorização</a></li>
								
							</ul>
						</li>
					
				</ul>
				
				
				
				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/docs/frontend/manual/">Frontend</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/frontend/manual/">Manual do Utilizador</a></li>
								
									<li class="nav-item "><a href="/docs/frontend/programador/">Perspetiva do Programador</a></li>
								
							</ul>
						</li>
					
				</ul>
				
				
				
				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/docs/desenvolvimento/TICK/">Operações</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/TICK/">Métricas</a></li>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/testes/">Testes</a></li>
								
							</ul>
						</li>
					
				</ul>
				
				

				
				
				
				
				
				
				
				
				
				
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Especificação</h2>
				<h3>Jenkins</h3>
			</div>
			<article class="content">
				<h3 id="overview">Overview</h3>

<p>No que toca a pipeline <strong>Jenkins</strong> disponibilizada, esta permite que o produto corrente seja sempre continuamente e automaticamente atualizado, e sequencialmente pronto a ser utilizado, garantindo que o software da versão estável mais recente esteja sempre disponível e funcional no ambiente de execução cliente. No que toca ao seu desenho geral, foi delineada uma pipeline standard, que segue o modelo geral <strong>build-test-package-deploy</strong>.</p>

<p><img src="/images/spec/es_pipeline_overview.PNG?raw=true" alt="pipeline-jenkins-ov" title="Pipeline Jenkins Overview" /></p>

<p>A configuração completa da pipeline não é apenas contemplada no código: na configuração desta pipeline no ambiente Jenkins a trabalhar, deve ser introduzido para usar o Jenkinsfile disponibilizado, e ainda deve ser dado corretamente o repositório na qual se encontra este projeto, de forma de haver um <em>checkout</em> implícito ao SCM antes de operacionalizar o <em>workflow</em> dado. Para isto, de notar que também é necessário configurar credenciais para o acesso ao repositório SCM pretendido.</p>

<h3 id="fases-da-pipeline">Fases da pipeline</h3>

<p>As <strong>fases de execução</strong> da presente pipeline são as seguintes:</p>

<ul>
  <li>
    <p><strong>Build Java 8</strong> – Faz a assemblagem de cada módulo Java 8, utilizando o Maven. Os testes não podem ser executados nesta fase, pois serão realizados numa fase posterior. Devido a haver seis módulos independentes Java no nosso projeto, e sendo que era desejado que o código da pipeline fosse o mais curto possível e o mais programático possível (no caso da quantidade de módulos aumentasse no futuro, e assim ser mais rápido de integrar um novo módulo em todas o ciclo de vida da pipeline), usou-se uma script que passa por uma lista de nomes de diretórios presentes no projeto, com o código de cada módulo, na qual executa a diretiva <strong>“install”</strong> do Maven, com a propriedade <strong>“skipTests”</strong>.</p>
  </li>
  <li>
    <p><strong>Build Java 11</strong> – Similarmente à fase anterior, é feito o <em>build</em> de cada módulo Java, neste caso com a versão 11. Embora faça parte do mesmo contexto do que seria normalmente uma fase, é necessária esta divisão devido à diretiva para utilização do Java 11 nesta fase. Esta maneira foi a mais fácil de ser integrada na pipeline.</p>
  </li>
  <li>
    <p><strong>Test Java 8</strong> – Esta fase trata de executar todos os testes de integração ou unitários em todos os módulos Java do software. Também é executado de forma programática e sequencial para cada aplicação Java 8, portanto detém o mesmo fluxo é feito para as fases anteriores. A diretiva de <em>lifecycle</em> Maven é a utilizada para utilizar todos os testes, que é o <strong>“test”</strong>.</p>
  </li>
  <li><strong>Test Java 11</strong> – Com semelhanças às fases de build explicitadas anteriormente, este usa também a diretiva <strong>“tools”</strong> com a configuração da versão de SDK para Java 11. Esta fase, tal como a anterior, faz sequencialmente os testes aos módulos Java dos diretórios dos micro-serviços Java 11, incluídos em cada um destes <em>(./src/test/*)</em>.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tools {
  jdk "jdk11"
}
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Upload artifacts</strong> – Após as fases lógicas de <em>build</em> e teste, esta fase assegura que os artefactos resultantes da assemblagem dos pacotes de software (JAR/WAR) da versão correspondente, seja armazenado num repositório de artefactos JFrog. Neste caso, o repositório é o oficial da disciplina, em <strong>http://192.168.160.49:8081/artifactory/</strong>maven_es2021. Isto é configurado no pom.xml e no settings.xml, e é usado apenas para o upload destes artefactos. Esta fase é transparente à versão do Java utilizada.</p>
  </li>
  <li>
    <p><strong>Push images</strong> – Esta fase realiza o <em>build</em> das imagens Docker e, consequentemente, o upload das imagens resultantes para o Docker Registry, que vai ser utilizado pela máquina de instalação do produto como a fonte de imagens no docker-compose de instalação. Neste caso, o repositório utilizado é, também, o oficial, localizado em <strong>http://192.168.160.48:5000</strong>. Esta fase faz o <em>build</em> a partir dos Dockerfiles localizados em cada módulo, e upload sequencial (<em>push</em>) para cada módulo do projeto. A fase inclui todos os componentes, <strong>incluindo a aplicação Node/ReactJS</strong>.</p>
  </li>
  <li><strong>Deploy</strong> – Esta fase acede à máquina de instalação para a entrega do pacote de software, mediante credenciais. Nesta versão final do projeto, a instalação de todos os serviços é feita numa máquina gerida pelo grupo, acedida em <strong>skyview.rrosmaninho.com, no porto 443</strong>, usando credenciais configuradas com um utilizador dependente (<strong>‘jenkins’</strong>) para o efeito. 
Esta fase acede primeiramente à máquina e limpa a instalação anterior, removendo todos os seus componentes. De seguida, remove ficheiros dependentes, como o manisfest YAML de instalação automática dos variados serviços (<em>docker-compose.yml</em>), assim como ficheiros de configuração de alguns serviços, necessários para o seu correto funcionamento. Depois, são novamente copiados para a mesma máquina o manifest e os ficheiros de configuração atualizados. Por fim, faz a execução do YAML sobre o Docker daemon (a partir do <code class="language-plaintext highlighter-rouge">docker-compose up</code>).</li>
</ul>

<h3 id="alterações-posteriores">Alterações posteriores</h3>

<p>No caso de a máquina remota poder ser diferente ou na eventualidade da sua migração para outra localização, a definições dos campos da variável global <strong>“remote”</strong> devem ser atualizados: o <em>“host”</em> e o <em>“port”</em>. O campo <em>“name”</em> também pode ser mudado, no entanto não é fundamental para o funcionamento dos acessos SSH, servindo apenas para fazer a identificação posterior.</p>

<p>Esta máquina destino para a instalação e entrega do produto <strong>deve ter um Docker deamon preparado com execução de comandos em modo <em>non-root</em></strong>. Quaisquer certificados essenciais para o acesso ao Docker Registry devem ser instalados na máquina (certificados cliente em <em>/etc/docker/certs</em>; no caso de haver um certificado de CA Root independente, é ainda necessário instalá-lo no seu sistema Linux; no entanto, se for um ficheiro em formato PEM com a cadeia de certificação, é apenas necessário coloca-lo no diretório dito primeiramente).</p>

<p>No caso de possuir um registry Docker privado, é possível mudá-lo facilmente no código da pipeline, sendo que pode ser alterado na variável de ambiente <em>REGISTRYHOST</em> existente. Assim, o <em>push</em> e <em>pull</em> das imagens Docker na fase de <strong>Upload images</strong> poderá ser feito de outro Registry facilmente que não o por defeito neste projeto. É necessário, no entanto, que este esteja acessível tanto da máquina target, como na ferramenta Jenkins que vai ser utilizada.</p>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
