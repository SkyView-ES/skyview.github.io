<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Monitorização | SkyView</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Monitorização" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Métricas" />
<meta property="og:description" content="Métricas" />
<link rel="canonical" href="http://localhost:4000/docs/especificacao/monitoring/" />
<meta property="og:url" content="http://localhost:4000/docs/especificacao/monitoring/" />
<meta property="og:site_name" content="SkyView" />
<script type="application/ld+json">
{"@type":"Article","url":"http://localhost:4000/docs/especificacao/monitoring/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/images/favicon.png"}},"headline":"Monitorização","description":"Métricas","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="SkyView" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/images/favicon.png">

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/" style="display:table;">
					<span style="display:table-cell;vertical-align:middle;" class="back-arrow icon"><svg fill="#000000" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><rect id="backgroundrect" width="100%" height="100%" x="0" y="0" fill="none" stroke="none"/>
  
  
<g class="currentLayer" style=""><title>Layer 1</title><path d="M0 0h24v24H0z" fill="none" id="svg_1"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" id="svg_2" class="selected" fill="#ffffff" fill-opacity="1"/></g></svg></span>
					<img style="display:table-cell;" src="/images/favicon.png" width="40" height="40" alt="SkyView logo">
				</a>
				SkyView
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href=""><b>Documentação</b></a>
					</li>
				</ul>

				
				
				
				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/docs/an%C3%A1lise/cenarios/">Análise</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/an%C3%A1lise/cenarios/">Cenários</a></li>
								
							</ul>
						</li>
					
				</ul>
				
				
				
				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/docs/desenvolvimento/arquitetura/">Desenvolvimento</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/arquitetura/">Arquitetura</a></li>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/consumers/">Consumers</a></li>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/producers/">Producers</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/docs/especificacao/jenkins/">Especificação</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/especificacao/jenkins/">Jenkins</a></li>
								
									<li class="nav-item "><a href="/docs/especificacao/deployment/">Deployment</a></li>
								
									<li class="nav-item current"><a href="/docs/especificacao/monitoring/">Monitorização</a></li>
								
							</ul>
						</li>
					
				</ul>
				
				
				
				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/docs/frontend/manual/">Frontend</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/frontend/manual/">Manual do Utilizador</a></li>
								
									<li class="nav-item "><a href="/docs/frontend/programador/">Perspetiva do Programador</a></li>
								
							</ul>
						</li>
					
				</ul>
				
				
				
				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/docs/desenvolvimento/TICK/">Operações</a>
							<ul>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/TICK/">Métricas</a></li>
								
									<li class="nav-item "><a href="/docs/desenvolvimento/testes/">Testes</a></li>
								
							</ul>
						</li>
					
				</ul>
				
				

				
				
				
				
				
				
				
				
				
				
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Especificação</h2>
				<h3>Monitorização</h3>
			</div>
			<article class="content">
				<h2 id="métricas">Métricas</h2>

<h2 id="logger-agregado">Logger agregado</h2>

<h3 id="overview">Overview</h3>

<p>A monitorização centralizada aos registos de logging gerados pelas aplicações é feita a partir da instalação e configuração de uma <strong>stack EFK (Elasticsearch, Fluentd, Kibana)</strong>. Embora o Logstash seja o agregador de registos de logging mais utilizado, este modelo tem a particularidade de utilizar o <strong>Fluentd</strong> na sua vez, sendo que a sua configuração de cada fonte de dados é <strong>mais direta</strong>, e o <strong>formato de configuração é mais visualizável</strong> dentro do ficheiro.</p>

<p>A monitorização de logging é necessária para se observar simultaneamente um número elevado de aplicações Java, que estão constantemente a produzir logs a um rácio significativo, por exemplo, significando que poderá existir ali um problema com o micro-serviço, como um número muito elevado de exceções <em>runtime</em> no código Java, o que pode revelar um problema com o código ou de comunicação entre os vários serviços que este depende. Mais ainda, a visualização de logs a partir de um ponto central <strong>permite maior reação à ocorrência de problema</strong>, sendo que os logs de vários serviços podem ser <strong>visualizados ao mesmo tempo</strong>, ou com filtros a partir de botões na interface da dashboard. O armazenamento destes registos permite a <strong>recolha de informação histórica</strong> do funcionamento da aplicação, necessária para, por exemplo, <strong>auditorias</strong>.</p>

<h3 id="stack">Stack</h3>

<p>A stack é fornecida dentro do pacote de software do projeto, a partir da instalação <em>docker-compose</em>. Estes componentes ligam-se naturalmente entre si, não precisando de grandes configurações, sendo que estão dentro de containers e as configurações mínimas já estão garantidas.</p>

<p><img src="/images/spec/es_log_architecture.png?raw=true" alt="efk-stack-flux-model" title="EFK flux model" /></p>

<p>O modelo de agregação de logs ilustra que os vários componentes de software Java enviam os seus logs para o agregador <em>Fluentd</em> no <strong>formato Syslog</strong>, que expõe um porto e recebe os vários registos sob a forma de mensagens, enviando depois estes registos recebidos para o serviço <strong>Elasticsearch</strong>. Esta abordagem é muito simples de implementar, no entanto <strong>pode sofrer de bottleneck em termos de performance e prontidão do envio das mensagens</strong> para o Elasticsearch em “tempo real”, pois com a escalabilidade do número de serviços existentes a monitorizar, poderá fazer com que um container de Fluentd não seja suficiente para o efeito; assim como <strong>poderá resultar em perda de registos</strong> de logging, <strong>devido ao protocolo UDP</strong> que é utilizado na transmissão de logs entre as aplicações e o agregador.</p>

<h3 id="integração-ao-software">Integração ao software</h3>

<p>As aplicações Quarkus são configuradas para enviar os seus logs a partir da configuração de parâmetros nos ficheiros <em>“application.properties”</em> correspondentes. <strong>A integração com a <em>stack</em> EFK com Quarkus é, então, trivial</strong>, superiorizando-se a aplicações com base em Spring Boot, que requerem a criação de <em>appenders</em>.</p>

<p><img src="/images/spec/log_config_app_quarkus.PNG?raw=true" alt="log-config-quarkus-example" title="Example of the Quarkus logging integration with the log aggregator" /></p>

<h3 id="visualização-de-logs">Visualização de logs</h3>

<p>A ferramenta de visualização escolhida é o <strong>Kibana</strong>, pois está <strong>naturalmente integrada</strong> como parte da stack de logs centralizados, sendo que a visualização de logs e suas estatísticas base são facilmente criadas em <strong>painéis</strong>, e consequentemente <strong>dashboards</strong>.</p>

<p>A dashboard de visualização realizada serve para ter o mínimo de informação prontamente disponível que se achou útil: em primeiro, uma <strong>tabela</strong> que mostra <strong>todos os registos de todos os logs</strong> da infraestrtura mediante o <strong>intervalo de tempo</strong> filtrado, que inclui, para além da <em>mensagem</em> os campos do <em>nome dos serviços</em> (ou seja, das aplicações) e o <em>timestamp</em> da sua ocorrência; depois, existe ainda um <strong>gráfico de barras da contagem de logs totais</strong>, nas últimas doze horas. Por fim, existe um painel de <strong>visualização de proporção de logs de cada aplicação</strong> a partir do <strong>tamanho da letra</strong> (quanto maior a letra em relação aos outros nomes, mais logs está a produzir comparativamente).</p>

<p>Estes painéis, combinado com os filtros que estão integrados nas páginas das dashboards, permite rapidamente <strong>flitrar por aplicação</strong> ou aplicações, <strong>limitar intervalos</strong> de tempo para visualização, entre outros. Assim, a monitorização de logging atinge o nível de controlo desejado.</p>

<p><img src="/images/spec/kibana_dashboard.PNG?raw=true" alt="kibana-dashboard-ss" title="Kibana dashboard for log monitoring" /></p>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
